---
title: "R Notebook"
author:"Jackson Menoher"
output: html_notebook
---

Imortation of tidy data libraries 
```{r}
library(tidyverse)
library(janitor) # cleaning tidy data 
#library(knitr)
```

Reading in the initial (RAW) dataframe into a variable
```{r}
library(readr)
df1 <- read_csv("courses.csv", skip = 1) %>% clean_names()
View(courses)
```

Cleaning the data

1.) We start with filtering out rows of the RAW dataframe such that we are left with data only pertaining to Calc I and Calc II lectures during fall and spring before the year of 2022.

2.) We now get rid of columns that are not relevant to the analysis we want to perform, by selecting only the columns of interest.

3.) To compute total enrollment of each class over several sections being taught at the same time we group that data by term and course title, then calculate the sum of total enrollment across each section.

4.) academic year is then generated by first separating the the column containing season and year so that these two seperate variables can be used for a vectorized conditional mutate into a academic year variable. 
```{r}
df2 <- df1 %>% 
  # 1.)
  filter(subject=="MA", title=="Calculus I" | title=="Calculus II", component=="LEC", term_7<4219, !grepl('Summer',term_8)) %>% 
  # 2.)
  select(section, term_7, term_8, title, tot_enrl) %>%
  # 3.)
  # grouping term and title as to correctly compute the sum of enrollment over each section 
  group_by(term_8, title) %>%
  summarise(enrolled=sum(tot_enrl)) %>%
  ungroup() %>%
  # 4.) 
  # seperating the term_8 variable into two variables representing the season and year
  separate(term_8, c('season', 'year')) %>%
  # turning year into an integer datatype
  mutate(year=as.integer(year)) %>%
  # making a variable for academic year 
  mutate(ay=case_when(
    season=="Fall" ~ str_c(year,"-",year+1), 
    season=="Spring" ~ str_c(year-1,"-",year) )) %>%
  # getting rid of the year variable 
  select(-c(year))

View(df2)
``` 
5.) The season and course titles are merged into one variable since we would like our ending dataframe to show enrollment with respect to a course during a fall or spring season.

6.) Lastly, the pivot_wider command in implemented to transform the dataframe into representing the total number of enrolled student with respect to a class title during the fall or spring. 
```{r}
df3 <- df2 %>% 
  # 5.)
  # merging season and class title 
  mutate(course=str_c((season)," ",(title))) %>%
  select(-c(season, title)) %>%
  # 6.) 
  pivot_wider(names_from=course, values_from=enrolled) %>%
  clean_names() %>%
  select(c(fall_calculus_i, spring_calculus_ii))
View(df3)
```

A scatter plot of enrollments of Calc I (fall) and Calc II (spring) is made for a visual assesment of the resulting dataframe. 
```{r}
ggplot(data = df3,
       mapping = aes(x=fall_calculus_i, 
                     y=spring_calculus_ii)) +
  geom_point(size=2) + geom_smooth(method=lm)
```

Now a linear model is made to approximate the relationship between enrollment of Calc I in the fall and Calc II in the spring, as well as for ANOVA analysis to see the statistical significance of the relationship approximated. 
```{r}
linear_model <- lm(spring_calculus_ii ~ fall_calculus_i, data=df3)
#summary(linear_model)
anova(linear_model)
#confint(linear_model)
```












